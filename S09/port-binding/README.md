# 일반적인 포트 바인딩 문제와 해결

## 문제
Docker Compose에서 `ports: 8000:5000`와 같이 직접적인 포트매핑을 사용하면서 replicas: 3으로 설정하면 오류가 발생함.
이유는:
1. 세 개의 컨테이너가 모두 호스트의 동일한 8000번 포트에 바인딩되기 때문임.
2. 한 포트는 한 번에 하나의 프로세스만 사용할 수 있으므로 첫 번째 컨테이너만 포트 실행, 나머지는 실패함.

-----

## 해결
### 1. 서로 다른 호스트 포트 사용
-  각 컨테이너에 고유한 호스트 포트를 할당
```
services:
  web:
    deploy:
      replicas: 3
    ports:
      - "8000-8002:5000"  # 8000, 8001, 8002 포트를 각 컨테이너의 5000 포트에 매핑
```

### 2. 로드 밸런서 사용 (Swarm 모드)
- Docker Swarm 모드를 사용
- Docker Swarm은 여러 복제본 간에 트래픽을 자동으로 분산시킴
```
services:
  web:
    deploy:
      replicas: 3
      mode: replicated
    ports:
      - "8000:5000"  # Swarm에서는 내부적으로 로드 밸런싱
```

### 3. 외부 로드 밸런서 사용
- Nginx, HAProxy 같은.외부 로드 밸런서를 설정하고, 각 컨테이너에 개별 포트를 할당

### 4. 네트워크 모드 변경 (비권장)
- 호스트 네트워크 모드는 컨테이너가 호스트의 네트워킹을 직접 사용하지만, 이는 격리 장점을 잃게 됨
```
services:
  web:
    deploy:
      replicas: 3
    network_mode: host  # 호스트 네트워크 사용 (권장하지 않음)
```
