# 섹션 6. 스토리지 

- [스토리지가 필요한 이유](#스토리지가-필요한-이유)
- [Docker 스토리지 유형](#docker-스토리지-유형)
- [볼륨 사용 시 주의사항](#익명-볼륨-vs-기명-볼륨)
- [익명 볼륨 vs 기명 볼륨](#익명-볼륨-vs-기명-볼륨)

-----------------------------

## 스토리지가 필요한 이유
### 1. 컨테이너의 임시적 특성
- 컨테이너 실행 시 기본적으로 쓰기 가능한 계층(레이어)이 생성됨.
- 컨테이너 종료 시 이 레이어의 데이터는 소멸됨.
- 데이터베이스와 같이 영구 저장이 필요한 경우 별도 스토리지 솔루션 필요
### 2. 호스트와 컨테이너 간 파일 공유 필요성
- 호스트의 특정 파일/폴더를 컨테이너에서 사용하거나 공유할 필요가 있음
- 읽기 전용(RO) 또는 읽기/쓰기(RW) 권한 설정 가능

## Docker 스토리지 유형

![Image](https://github.com/user-attachments/assets/85acedb0-825a-4050-9006-b8d6e0157861)

### 1. 볼륨(Volume)
#### Named Volume
- `docker volume create [이름]` 명령으로 생성
- `docker run -v [이름]:[마운트할 경로]:[rw\ro]` 형식으로 사용
- 컨테이너 삭제 시에도 볼륨은 유지됨
- `docker volume rm [이름]` 명령으로 별도 삭제 필요

#### Anonymous Volume
- Dockerfile의 VOLUME 지시어 사용하고, docker run에서 별도 -v옵션 없을 때 생성
- `docker rm -v` 옵션 사용 시 컨테이너와 함께 삭제됨
- 실무에서는 관리의 어려움으로 사용을 지양해야 함

### 2. 바인드 마운트(Bind Mount)
- 호스트의 파일/디렉토리를 컨테이너에 직접 마운트
- `docker run -v [호스트경로]:[컨테이너경로]:[rw|ro]` 형식으로 사용
- 주의사항:
    - 호스트 경로가 폴더면 컨테이너 경로도 폴더여야 함
    - 호스트 경로가 파일이면 컨테이너 경로도 파일명을 포함해야 함
    - 민감한 호스트 파일/폴더를 마운트할 때는 가능하면 `:ro`(읽기 전용) 옵션 사용

### 3. tmpfs 마운트
- 메모리에만 존재하는 임시 파일 시스템
- 컨테이너 종료 시 데이터 완전 소멸
- 민감한 정보를 임시로 저장할 때 유용
- 성능은 좋지만 휘발성이 높아 주의가 필요

## 볼륨 사용 시 주의사항
### 1. 볼륨 공유 시 주의점
- 여러 컨테이너가 동일한 볼륨을 공유할 수 있음
- 동시 접근 시 데이터 일관성 문제 발생 가능
- 가능하면 읽기 전용(`:ro`) 옵션 고려

### 2. 볼륨 관리
- Named Volume은 명시적으로 삭제하지 않으면 계속 유지됨
- `-v` 옵션으로 컨테이너 삭제 시에도 Named Volume은 삭제되지 않음
- 정기적인 볼륨 정리 필요(`docker volume prune`)

### 3. 실무 권장사항
- 익명 볼륨보다는 Named Volume 사용 권장
- 민감한 데이터 접근 시, 여러 컨테이너가 한 폴더 동시 접근 시 읽기 전용으로 설정
- 필요한 경우에만 쓰기 권한 부여

## 익명 볼륨 vs 기명 볼륨
### Anonymous Volume
![Image](https://github.com/user-attachments/assets/a9acc644-a001-4720-adb0-a34d2df19811)

![Image](https://github.com/user-attachments/assets/370baf19-4816-40e2-a5ec-6459e0882c77)

- 볼륨 이름이 랜덤 문자열이라고 해서 무조건 익명 볼륨이 아님. 라벨을 확인해야함.

### Named Volume
![Image](https://github.com/user-attachments/assets/d2a472f5-8c93-4a3e-92e8-3004b6ce9716)

![Image](https://github.com/user-attachments/assets/1797483e-69e0-4893-88c9-4d69d170a4d4)

- 볼륨 삭제할 떄 이름을 지정해줘야함.