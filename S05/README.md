# 섹션 5. 네트워크

- [도커 기본 네트워크와 문제점](#도커-기본-네트워크와-문제점)
- [커스텀 네트워크 생성 및 활용](#커스텀-네트워크-생성-및-활용)

---

## 도커 기본 네트워크와 문제점

![Image](https://github.com/user-attachments/assets/bdd8a427-0d65-4dcd-a268-5f79137ce407)

### 1. Docker 네트워크 개요
#### Docker의 기본 네트워크 인터페이스
- `eth0` (컨테이너 내부 네트워크 인터페이스)
- `docker0` (호스트 시스템의 Docker 브리지 네트워크)

#### 기본 네트워크 구성의 문제점
- <b>컨테이너 이름</b>으로 네트워크 접근 <b>불가능</b>
- 172.17.0.5와 같은 IP 주소로만 접근 가능

#### 네트워크 연결 방법
- `--link` 옵션 사용: `docker run -d -P --link pg web`
    - 이 방식은 legacy 방식으로 <b>향후 사라질 예정</b> (쓰지말자)
- 사용자 정의 네트워크 생성: `docker create network {이름}`
    - 권장되는 방법

### 2. default.sh 해석

#### 첫 번째 실습
- 기본 네트워크에서의 동작
    - 두 개의 busybox 컨테이너(b1, b2)를 실행
    - 각 컨테이너의 IP 확인 (ifconfig eth0)
    - 컨테이너 간 ping 테스트
        - 이름으로 ping 시도 → 실패
        - IP로 ping 시도 → 성공
- 두 번째 실습은 `--link` 옵션 사용
    - b1 컨테이너 실행
    - b2 컨테이너를 b1에 링크하여 실행
    - 이름으로 ping 테스트 → b1으로의 ping이 성공할 것으로 예상
- Docker 네트워크를 더 효과적으로 관리하려면 사용자 정의 네트워크를 만들고 컨테이너들을 해당 네트워크에 연결하는 방식이 권장됨.
![Image](https://github.com/user-attachments/assets/53ccbe14-2070-419c-9d5d-0fdb5a502302)

---

## 커스텀 네트워크 생성 및 활용

![Image](https://github.com/user-attachments/assets/fd961c15-e37a-41a1-9529-838b8adb9fef)

### 1. 구조 설명

#### 기본 구성 요소 
- 호스트 시스템: 모든 Docker 구성 요소를 포함하는 물리적 시스템
- Rex 커스텀 네트워크: `docker network create rex` 명령으로 생성된 사용자 정의 네트워크
- Docker 내장 DNS: 커스텀 네트워크에 자동으로 제공되는 내장 DNS 서비스
- 컨테이너: b1, b2, b3 세 개의 busybox 컨테이너

#### 네트워크 특성
- 각 컨테이너는 `172.18.0.x` 형식의 IP 주소 할당
- 컨테이너 b1과 b2는 "bb"라는 공통 네트워크 별칭을 가짐
- 내장 DNS를 통해 컨테이너 이름 및 별칭으로 통신 가능

### 2. 주요 특징 및 장점

#### 이름 기반 통신
- 기본 Docker 네트워크에서는 IP로만 통신 가능하지만, 커스텀 네트워크에서는 컨테이너 이름으로 통신 가능
- 내장 DNS가 이름 해석을 자동으로 처리

#### 네트워크 별칭의 활용
- 여러 컨테이너에 동일한 별칭 부여 가능
- 별칭으로 접근 시 라운드 로빈 방식으로 컨테이너에 요청 분산
- 간단한 로드 밸런싱 구현 가능

#### 실용적 사용 사례
- 웹 서버 클러스터: 여러 웹 서버 컨테이너에 "web" 별칭 부여
- 마이크로서비스: 서비스별 여러 인스턴스에 서비스 이름 별칭 부여
- 블루/그린 배포: 새 버전 컨테이너를 추가한 후 기존 서비스 별칭 부여

### docker inspect에서 aliases와 DNSNames는 뭐가 다른가?

![Image](https://github.com/user-attachments/assets/b26e0fb4-f70c-4236-a10e-ae7f2907ea9f)

#### Aliases (별칭)
- `--network-alias` 옵션으로 명시적으로 설정한 별명들의 목록
- 사용자가 직접 지정한 추가 식별자
- 여러 컨테이너가 동일한 별칭을 가질 수 있어 라운드 로빈 로드 밸런싱이 가능
- 이 경우 "bb"는 `--network-alias bb` 옵션으로 추가한 별칭

#### DNSNames (DNS 이름)
- 컨테이너가 네트워크 내에서 참조될 수 있는 모든 DNS 이름 목록
- 다음을 포함:
    - 컨테이너의 이름 ("b1")
    - 설정된 모든 네트워크 별칭 ("bb")
    - 컨테이너 ID의 단축 형태 ("44bf72929dae")

#### 주요 차이점
- `Aliases`는 사용자가 명시적으로 설정한 별칭만 포함
- `DNSNames`는 컨테이너를 참조할 수 있는 모든 방법(이름, ID, 별칭)을 포함하는 포괄적인 목록

### 결론
- 컨테이너 b3에서 ping bb를 하면 b1이나 b2에 랜덤으로 트래픽이 분산됨.
	- <b>동일한 네트워크 별칭(bb)을 가진 컨테이너가 여러 개</b> 있을 때 DNS 요청은 라운드 로빈 방식으로 분산되어, 간단한 <b>로드밸런싱</b> 구현 가능함.
- b1, b2는 컨테이너 이름이라도 커스텀 네트워크에서는 ping b1, ping b2라고 쓰면 통신이 가능함.
	- Docker의 기본 브리지 네트워크에서는 컨테이너 이름으로 통신이 안 되지만, <b>사용자 정의 네트워크(커스텀 네트워크)에서는 컨테이너 이름과 별칭 모두로 통신이 가능</b>함.