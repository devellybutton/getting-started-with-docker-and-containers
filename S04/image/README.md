# 섹션 4. 이미지
- [이미지와 레이어](#이미지와-레이어)
- [Dockerfile](#dockerfile)
- [자주 쓰는 명령어](#자주-쓰는-명령어)
- [빌드 컨텍스트와 이미지 빌드](#빌드-컨텍스트와-이미지-빌드)
- [빌드 캐시의 정의 및 활용](#빌드-캐시의-정의-및-활용)

---

## 이미지와 레이어

![Image](https://github.com/user-attachments/assets/7143af1b-9f79-4f33-b404-1d2c65c761a3)

### 1. 이미지의 개념과 특징
#### 이미지
- 컨테이너(프로세스)를 실행하는데 필요한 모든 것들을 포함하는 압축 파일
- 런타임(python 등), 바이너리(실행파일), 코드, 라이브러리, 설정 파일 등

#### 이미지에 포함되는 것들
- 런타임 환경: Python, Node.js, Java 등의 실행 환경
- 바이너리(실행 파일): 애플리케이션 실행 파일
- 애플리케이션 코드: 개발자가 작성한 소스 코드
- 라이브러리 및 종속성: 애플리케이션이 의존하는 라이브러리 
- 환경 변수 및 설정 파일: 애플리케이션 구성 정보
- 파일 시스템 구조: 필요한 디렉토리 및 파일 구조

#### 이미지의 주요 특징
- 불변성, 계층화된 구조, 상태 비저장(Stateless), 이식성

| 개념                | 설명                                                                                         |
|-------------------|--------------------------------------------------------------------------------------------|
| **불변성(Immutability)** | 컨테이너 이미지는 한 번 생성되면 변경할 수 없으며, 수정이 필요할 경우 새로운 이미지를 만들어야 함. <br> 이 특징은 환경의 일관성을 보장하고 버전 관리가 용이하게 함.         |
| **계층 구조(Layered Architecture)** | 컨테이너 이미지는 여러 계층(layer)로 구성된 파일 시스템을 사용함. <br> 각 명령(RUN, COPY, ADD 등)은 이전 계층에 변경을 적용하며, 이 변경 사항은 새 계층으로 캐시됨.        |
| **캐시(Caching)**       | 이미 빌드된 계층은 캐시되어, 이미 변경되지 않은 계층을 다시 빌드할 필요가 없어 빌드 시간이 단축되고 디스크 공간이 절약됨. <br> 여러 이미지는 동일한 기본 계층을 공유할 수 있음. |
| **상태 없는 컨테이너(Stateless Container)** | 상태가 없는 컨테이너는 삭제되면 그 안의 모든 변경 사항이 사라짐. <br> 즉, 컨테이너는 실행 중에만 데이터를 보유하고 종료 후에는 모든 변화가 사라지는 것임. |
| **이식성(Portability)**  | 컨테이너는 필요한 모든 의존성(라이브러리, 설정 등)을 포함하여, 동일한 컨테이너를 다양한 환경에서 실행할 수 있게 함. <br> "내 컴퓨터에서는 안 돌아가" 문제를 해결함.  |

#### 데이터 지속성
- 컨테이너는 임시적인 환경이므로, 영구적인 데이터 저장을 위해서는:
    - <b>볼륨(Volumes)</b>: Docker에서 관리하는 영구 저장소
    - <b>바인드 마운트(Bind Mounts)</b>: 호스트 파일 시스템의 특정 경로를 컨테이너에 마운트
    - <b>tmpfs 마운트</b>: 메모리에만 데이터 저장(리부팅 시 소멸)

### 2. Docker 컨테이너의 상태 비저장 특성

![Image](https://github.com/user-attachments/assets/92ebc3f7-aa65-47dc-a55c-2be5021fffff)

#### Docker의 특징
- 컨테이너는 항상 이미지의 원본 상태에서 시작
- 컨테이너 내부의 변경사항은 해당 컨테이너의 생명주기 동안만 유지
- 데이터를 영구적으로 보존하려면 볼륨(volume)이나 바인드 마운트(bind mount)를 사용해야 함

![Image](https://github.com/user-attachments/assets/0ae37530-4207-417a-9083-f905eabf5ad9)

---

## Dockerfile

### 1. Dockerfile
- 이미지를 만들기 위한 설계도 역할
- Dockerfile에 명시된 명령어(Instruction) 기반으로 이미지를 생성함
- 작동 방식 : 설계도 => 이미지 생성(빌드) => 실행 

### 2. 명령어 형식
```
Instruction arguments
```
- <b>INSTRUCTION</b>: 대문자로 작성하는 명령어 (예: FROM, RUN, COPY)
- <b>arguments</b>: 해당 명령어에 전달할 인자값

---

## 자주 쓰는 명령어

---

## 빌드 컨텍스트와 이미지 빌드

---

## 빌드 캐시의 정의 및 활용